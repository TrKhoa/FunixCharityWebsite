<%- include('../includes/head.ejs') %>
</head>

<body>
    <%- include('../includes/sidebar.ejs') %>

    <!--báo lỗi-->
    <% if(errorMessage) { %>
    <div class="alert alert-danger" role="alert">
      <%= errorMessage %>
    </div>
    <% } %>

    <!--Kiểm tra user, nếu user là admin thì được toàn quyền, nếu là Semi-Admin thì bị giới hạn-->
    <% if(userSession.status === 3){
      ''
    } else if((user.status === 3 && userSession.status !== 3 || (user.status === 2 && userSession.username !== user.username))){
      notAuth();
    }%>
    <div class="row">
        <div class="col-lg-12">
          <h1><%= edit ? 'Chỉnh sửa tài khoản' : 'Thêm tài khoản' %></h1>
          <form enctype="multipart/form-data" action=<%= edit ? "/admin/user-edit/"+user.username : "/admin/user-add" %> method="post" class="mt-5">
            <div class="mb-3">
              <label for="name" class="form-label">Tên</label>
              <input type="text" class="form-control" id="name" name="name" aria-describedby="nameHelp" value=<%= user ? user.name : '' %> >
            </div>
            <% if(!edit) {%>
              <div class="mb-3">
                <label for="username" class="form-label">Tài khoản</label>
                <input type="text" class="form-control" id="username" name="username" value=<%= user ? user.username : '' %>>
              </div>
              <% } %>
              <div class="col-lg-4">
                <label for="image" class="form-label">Hình ảnh</label>
                <input type="file" class="form-control" id="image" name="image">
              </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" name="email" value=<%= user ? user.email : '' %>>
            </div>
            <div class="mb-3">
              <label for="number" class="form-label">Số điện thoại</label>
              <input type="number" class="form-control" id="phone" name="phone" value=<%= user ? user.phone : '' %>>
            </div>
            <% if(!edit) {%>
            <div class="mb-3">
              <label for="password" class="form-label">Mật khẩu</label>
              <input type="password" class="form-control" id="password" name="password">
            </div>
            <div class="mb-3">
              <label for="passwordConfirm" class="form-label">Nhập lại mật khẩu</label>
              <input type="password" class="form-control" id="passwordConfirm" name="passwordConfirm">
            </div>
            <% } %>
            <% if((userSession.status === 3 && user.username != userSession.username) || !edit ||(user.status===0) ) { %>
            <div class="mb-3">
              <label for="type" class="form-label">Loại tài khoản</label>
              <select id="type" class="form-select" name="type">
                <option value="1">User</option>
                <option value="2">Semi-Admin</option>
              </select>
            </div>
            <% } %>
            <a href="/admin/user">
              <button type="button" class="btn btn-secondary">Hủy</button>
            </a>
            <button type="submit" class="btn btn-primary">Xác nhận</button>
            <input class="btn btn-primary" type="reset">
          </form>
        </div>
      </div>
      <script>
        $(document).ready(function() {
          $('#name').val("<%= user ? user.name : '' %>");
        });
      </script>
    <%- include('../includes/end.ejs') %>
</body>